<!DOCTYPE html>
<html lang="en">
    <head>
        <style>
            button {
                
               
                cursor: pointer;
                }

                dialog {
                border: none;
                border-radius: 10px;
                box-shadow: 0 4px 16px rgba(0,0,0,0.25);
                padding: 24px 32px;
                max-width: 600px;
                text-align: left;
                }

                dialog::backdrop {
                background: rgba(0,0,0,0.3);
                }

                .close-btn {
                margin-top: 20px;
                padding: 8px 16px;
                background: #e74c3c;
                color: #fff;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                }

                .close-btn:hover {
                background: #c0392b;
                }
            input[name="radio"][value="no"] { 
            margin-left: 20px; /* Adjust as needed */
            
            }
            .container {
              display: grid;
              grid-template-columns: 250px 300px;
              

            }
            .container > div {
          
              padding: 3px;
              
              text-align: left;
              align-items: left;
            }
        

            .container2 {
              display: grid;
              grid-template-columns: 250px 550px 300px;
              grid-template-rows: 150px;

            }
            .container2 > div {
          
              padding: 2px;
              
              text-align: left;
              align-items: left;
            }

            .container3 {
              display: grid;
              grid-template-columns: 200px 350px 10px 600px;
              

            }
            .container3 > div {
          
              padding: 4px;
              /*border: 1px solid black;*/
              
              text-align: left;
              align-items: left;
            }
            .container4 {
              display: grid;
              grid-template-columns: 500px 300px;
              

            }
            .container4 > div {
          
              padding: 3px;
              
              
              text-align: left;
              align-items: left;
            }

            .smallcontainer {
              display: grid;
              grid-template-columns: 90px 90px 70px 90px 90px 90px;
              

            }
            .smallcontainer div {
          
              padding: 2px;
              
              text-align: left;
              align-items: left;
            }
            .smallcontainer2 {
              display: grid;
              grid-template-columns: 200px 200px 200px;
        
            }
            .smallcontainer2 div {
          
              padding: 2px;
              /*border: 1px solid black;*/
              text-align: left;
              align-items: left;
            }

            .small {
              display: grid;
              grid-template-columns: 30px 150px;
              

            }
            .small div {
          
              padding: 2px;
              
              text-align: left;
              align-items: left;
            }
            input[name="longAns"] {

                width: 300px;
                height: 30px;
                }

            input[name="fname"] {

                width: 190px;
                
                }
           
            </style>
    </head>
    <body>
        <form> 

            <fieldset>
                <legend><h2>Guest Info:</h2></legend>
                <label for="guestNR">How many guests from your group are coming (including children)?</label>
                <input type="number" min=1 max=10 id="guestNR"/>
                <br><br>

                <div id="gInfo" style="display:none">
                    

                </div>

                <br><br>
                <div id="testArray" style="display:none">
                    <input type="button" id="testbtn" value="Click me to see if the GuestInfoStorage array works"/>
                    <input type="button" id="Next2" value="Next"/>
                            
                </div>

            </fieldset>

            <fieldset id="Menu" style="display:none">
                <legend><h2>Menu</h2></legend>
                <p>The main course will likely be beef. We will update our website with the chosen menu when we know more, but this won't be until 2026. </p>

                <div id="guestMeals">
                </div>
                <input type="button" id="Next3" value="Next"/>
            </fieldset>

            <fieldset id="Bus" style="display:none">
                <legend><h2>Will any of you be taking the bus? What time?</h2></legend>
                <p>Remember that we will ask that you pay a small sum of money to cover some of the cost of hiring the bus. We will keep this under
                    the price of hiring a taxi, which are notoriously expensive in Norway, though this is always an option. As for payment options, 
                    I'll set that up on the website asap. 

                    Again, we aren't 100% sure about the times for the bus yet, or if we'll hire one for both pick-up and drop-off. It all depends on 
                    the amount of people who want/need to take the bus. All of this info will be posted to the website as soon as we know more.</p>
                
                <div id="BussInf">
                </div>
                <input type="button" id="Next4" value="Next"/>
            </fieldset>

            <fieldset id="Drinks" style="display:none">
                <legend><h2>Drink Vouchers</h2></legend>

                <p>Due to limited space and to save time (and because of the alcohol-serving laws in Norway), instead of having a normal bar
                    set-up we have to use drink-vouchers. These will be sold in packs of three on our website, and will be purchaseable using 
                    Vipps (Norway), Paypal and bank transfers. We ask that you buy these in advance, both to save time and so that we get a 
                    good idea of how many vouchers we will need and how many drinks we will need to provide. we will also set things up so that 
                    you can purchase some on-site as a last resort.<b>We will of course cover the welcome-drinks and wine with dinner.</b>
                </p>
                <div class="container4">

                    <div>
                        <b>I will set up the payment options via this website as soon as possible.</b>
                    </div>
                    <div>
                        <button id="openDialogBtn">More info</button>
                    </div>
                 </div>
                <dialog id="drinkInfo">
                    <h3>Drink menu</h3>
                    <p>
                        We are currently working on a drink menu that we will post to the website at some point. What we do know so far, is that 
                        we want to provide exciting mixed drinks with equally exciting <i>alcohol-free</i> versions! <br> <br>
                        Again, we haven't landed on the exact menu yet, but we know we want to serve pi√±a coladas and margaritas made in a slushie 
                        machine, as well as beer, wine and maybe some home-brewed hard cider and beer too. 
                        <br>
                    </p>
                    <button class="close-btn" id="closeDialogBtn">Close</button>
                  </dialog>
                  <p></p>
                
                <div id="Drinks">
                </div>
                <input type="button" id="Next5" value="Next"/>
            </fieldset>

            <fieldset id="End" style="display:none">
                <legend>Any questions?</legend>
               
                <label for="Questions">Please write any questions you have here and we will get back to you as soon as possible!</label><br>
                <input type="text" id="Questions" name="longAns"/>
                <submit></submit>
            </fieldset>
        </form>
        
        <!--What do I have left: 
        1) include +1's in the menu function XXX

        2) make the functions that append the bus and drink input

        3) make it so that the next buttons can only be interacted with if all previous inputs are filled in. 
        4) connect to a google sheets document-->


        <!-- <script src="building_own_code.js"></script> -->
        <script>
            const guests = document.getElementById("guestNR");
            const testbtn = document.getElementById("testbtn");
            const testArrayDiv = document.getElementById("testArray");
            
            let GuestInfoStorage = []; // Empty array to store all of the user answers from the GuestInfo fieldset in
            let counting = 0 // defines a global counting variable that is redefined when the updateField function is run. Stores this info for the next part of the RSVP.


            guests.addEventListener("change", updateField);

            testbtn.addEventListener("click", function() {
                console.log(GuestInfoStorage);
                alert(JSON.stringify(GuestInfoStorage, null, 2));
             });

             Next2.addEventListener("click", updateMeal);

             Next3.addEventListener("click", updateBus);
             Next4.addEventListener("click", function(){
                document.getElementById("Drinks").style.display = "block";
             });
             Next5.addEventListener("click", function(){
                 document.getElementById("End").style.display = "block"
             });


            function updateField() {

                document.getElementById("gInfo").innerHTML = '<legend><h3>Enter your full names here:</h3></legend><br>'; //deletes the html content of the guestDetailsDiv element.
                GuestInfoStorage = [];
                counting = guests.value; // redefines counting to match the number of guests entered by the user. 
                
                if (counting > 0 && counting < 11){ // Since I want a max of 10 guests, this makes sure that the code only works when the entered number is above 0 but below 11. 
                
                    document.getElementById("gInfo").style.display = "block";
                    testArrayDiv.style.display = "block";

                    for (let i = 0; i<counting; i++){ //runs the following code up to the number specified by user. 
                        let GuestiInfo = {}; // Empty object to store all of the answers in, Guest Name, +1 answer, +1 name, +1 relationship
                
                        // myInp is a new div element of the class container that will be added to gInfo later
                        const myInp = document.createElement("div"); myInp.className="container";
                        // defines the code contained in myInp
                        myInp.innerHTML = `
                        <div>
                        <label>Guest ${i+1} full name: </label>
                        <input type="text" id="GuestID${i+1}" name="fname" required/> <br><br>
                        </div>
                        <div id="yesno+1${i+1}">
                            <legend>Would you like to request a +1?</legend>
                            <input type="radio" id="yes${i+1}" name="+1${i+1}" value="yes"required/>
                            <label for="yes${i+1}">Yes</label>
                            <input type="radio" id="no${i+1}" name="+1${i+1}" value="no" required/>
                            <label for="no${i+1}">No</label><br><br>
                        </div>
                        `;

                        document.getElementById("gInfo").appendChild(myInp);

                        const GuestName = document.getElementById(`GuestID${i+1}`);
                        GuestName.addEventListener("change", function(){
                            GuestiInfo.GuestName = this.value;
                        });

                        const plusOneYes = document.getElementById(`yes${i+1}`);
                        const plusOneNo = document.getElementById(`no${i+1}`);
                        
                       
                        plusOneYes.addEventListener("click", function() {
                            const plusOneInfo = document.createElement("div"); plusOneInfo.className = "container"; plusOneInfo.id = `+1info${i+1}`;
                            plusOneInfo.innerHTML = `
                            <div> <label>Name of plus one for Guest ${i+1}: </label> </div>
                            <div> <label>Relationship between plus one and Guest ${i+1}: </label></div>
                            <div><input type="text" id="plusOneName${i+1}" name="fname" /> </div>
                            <div><input type="text" id="plusOneRel${i+1}" name="longAns"/></div> <br><br>`;
                            myInp.appendChild(plusOneInfo);
                            GuestiInfo.plus1 = "yes";

                            const plusOneName = document.getElementById(`plusOneName${i+1}`);
                            const plusOneRel = document.getElementById(`plusOneRel${i+1}`);

                            plusOneName.addEventListener("change", function(){
                                GuestiInfo.plusOneName = this.value;
                            });

                            plusOneRel.addEventListener("change", function(){
                                GuestiInfo.plusOneRel = this.value;
                            });
                            

                        })

                        plusOneNo.addEventListener("click", function() {
                            const changedFromYes = document.getElementById(`+1info${i+1}`)
                            if (changedFromYes) changedFromYes.remove();
                            GuestiInfo.plus1 = "no";
                        
                    
                        })

                        
                        // Instead of GuestInfoStorage.push(GuestiInfo);
                        GuestInfoStorage[i] = GuestiInfo; // <-- Assign by index!
                    }; 
                    
                }
                else {
                    window.alert("Please enter a number between 1 and 10");
                }
                
            }
        
            
            

            function updateMeal() {

                document.getElementById("guestMeals").innerHTML = ''; //deletes the html content of the guestDetailsDiv element.
                document.getElementById("Menu").style.display = "block";

                const guestMealsDiv = document.getElementById("guestMeals");
               
                for (let i = 0; i<counting; i++){
                    //let guestName = GuestInfoStorage[i].GuestName;
                    let guestName = GuestInfoStorage[i].GuestName;
                    let plus1Name = GuestInfoStorage[i].plusOneName || ""; // If undefined, use ""

                    

                    //const newInp = createMealSection(guestName);
                    //guestMealsDiv.appendChild(newInp);
                    guestMealsDiv.appendChild(createMealSection(guestName));

                    if (plus1Name.trim() !== "") {
                        //const plusN = createMealSection(plus1Name);
                        //guestMealsDiv.appendChild(plusN);
                        guestMealsDiv.appendChild(createMealSection(plus1Name));
                    }
                    
                   // document.getElementById("guestMeals").appendChild(guestMealsDiv);
                    
                };
        
            }

            // Helper function for updateMeal
            function createMealSection(personName) {
                let section = document.createElement("div");section.className = "container2";
                section.innerHTML = `
                <div>
                    <legend><b>Enter your meal preferences here:</b></legend><br>
                    <label>${personName}: </label>
                    <select id="menu${personName}"> 
                        <option value="">--Please choose an option--</option>
                        <option value="Standard meal">Standard meal</option>
                        <option value="Vegan">Vegan</option>
                        <option value="Vegetarian">Vegetarian</option>
                        </select>
                </div>
                <div>
                    <legend><b>Do you have any of the following allergies/intolerances?</b></legend>
                    <div class="smallcontainer">
                        <div>
                            <input type="checkbox" id="Gluten${personName}" value="Gluten">
                            <label for="Gluten${personName}">Gluten</label>
                        </div>
                        <div>
                            <select id="Gsev${personName}">
                                <option>Mild</option>
                                <option>Moderate</option>
                                <option>Severe</option>
                            </select>
                        </div>  
                        <div>
                            <input type="checkbox" id="Dairy${personName}" value="Dairy">
                            <label for="Dairy${personName}">Dairy</label>
                        </div>
                        <div>
                            <select id="Dsev${personName}">
                                <option>Mild</option>
                                <option>Moderate</option>
                                <option>Severe</option>
                            </select>
                        </div> 
                        <div>
                        <input type="checkbox" id="Peanuts${personName}" value="Peanuts">
                            <label for="Peanuts${personName}">Peanuts</label>
                        </div>
                        <div>
                            <select id="Psev${personName}">
                                <option>Mild</option>
                                <option>Moderate</option>
                                <option>Severe</option>
                            </select>
                        </div> 
                        <div>
                            <input type="checkbox" id="MostNuts${personName}" value="MostNuts">
                            <label for="MostNuts${personName}">Tree nuts</label>
                        </div>
                        <div>
                            <select id="TNsev${personName}">
                                <option>Mild</option>
                                <option>Moderate</option>
                                <option>Severe</option>
                            </select>
                        </div>

                        <div>
                            <input type="checkbox" id="Egg${personName}" value="Egg">
                            <label for="Egg${personName}">Egg</label>
                        </div>
                        <div>
                            <select id="Esev${personName}">
                                <option>Mild</option>
                                <option>Moderate</option>
                                <option>Severe</option>
                            </select>
                        </div>

                        <div>
                            <input type="checkbox" id="Soy${personName}" value="Soy">
                            <label for="Soy${personName}">Soy</label>
                        </div>
                        <div>
                            <select id="Ssev${personName}">
                                <option>Mild</option>
                                <option>Moderate</option>
                                <option>Severe</option>
                            </select>
                        </div>

                        <div>
                            <input type="checkbox" id="Wheat${personName}" value="Wheat">
                            <label for="Wheat${personName}">Wheat</label>
                        </div>
                        <div>
                            <select id="Wsev${personName}">
                                <option>Mild</option>
                                <option>Moderate</option>
                                <option>Severe</option>
                            </select>
                        </div>

                        <div>
                            <input type="checkbox" id="Fish${personName}" value="Fish">
                            <label for="Fish${personName}">Fish</label>
                        </div> 
                        <div>
                            <select id="Fsev${personName}">
                                <option>Mild</option>
                                <option>Moderate</option>
                                <option>Severe</option>
                            </select>
                        </div>
                        
                        <div>
                            <input type="checkbox" id="Shellfish${personName}" value="Shellfish">
                            <label for="Shellfish${personName}">Shellfish</label>
                        </div>
                        <div>
                            <select id="SFsev${personName}">
                                <option>Mild</option>
                                <option>Moderate</option>
                                <option>Severe</option>
                            </select>
                        </div>
                     </div>
                </div>
                <div>
                    <legend><b>Any other intolerances/allergies we should know about?:</b></legend><br>
                    <input type="text" id="allergies${personName}" name="longAns"/>
                </div>
                `;
            return section;

            }


            function updateBus (){
                document.getElementById("BussInf").innerHTML = ''; //deletes the html content of the guestDetailsDiv element.
                document.getElementById("Bus").style.display = "block";

                const guestBusDiv = document.getElementById("BussInf");
               
                for (let i = 0; i<counting; i++){
                    //let guestName = GuestInfoStorage[i].GuestName;
                    let guestName = GuestInfoStorage[i].GuestName;
                    let plus1Name = GuestInfoStorage[i].plusOneName || ""; // If undefined, use ""

                    guestBusDiv.appendChild(createBusSection(guestName));

                    if (plus1Name.trim() !== "") {
                        //const plusN = createMealSection(plus1Name);
                        //guestMealsDiv.appendChild(plusN);
                        guestBusDiv.appendChild(createBusSection(plus1Name));
                    }
                    
                   // document.getElementById("guestMeals").appendChild(guestMealsDiv);
                    
                };
        
            }

            function makeSafe(str) {
                return str.replace(/\W/g, '_');
            }

            // Helper function for updatebus
            function createBusSection(personName) {
                const safeName = makeSafe(personName)
                let section = document.createElement("div");section.className = "container3";
                section.innerHTML = `
                 <div>
                    <label>${personName}: </label><br>
                    <input type="radio" id="yesBus${safeName}" name="Bus${safeName}" value="yes"/>
                    <label for="yesBus${safeName}">Yes</label>

                    <input type="radio" id="noBus${safeName}" name="Bus${safeName}" value="no"/>
                    <label for="noBus${safeName}">No</label>
                 </div>

                 <div id="ifYesBus${safeName}" style="display:none">
                    <legend><b>Which hotel will you be staying at?</b></legend><br>
                    <label>(Where should the bus pick you up/ drop you off?)</label>
                    <input type="text" id="hName${safeName}" name="longAns"/>
                 </div>
                 <div>
                    </div>

                 <div id="timesBus${safeName}" style="display:none">
                    <legend><b>What times would you want to take the bus?</b></legend>
                    <p>Info: we are early-birds, but if enough people would like to stay later than 01:00 am, we will consider pushing 
                        the second drop-off time back</p>

                    <div class="smallcontainer2"> 
                        <div class="small">
                            <div>
                            <input type="checkbox" id="times1${safeName}"/>
                            </div>
                            <div>
                            <label for="times1${safeName}">Pick-up at 01:30 pm (13:30)</label>
                            </div>
                        </div>
                        <div>
                            <legend>Drop-off times</legend>
                            <input type="radio" id="times2${safeName}" name="dropOff"/>
                            <label for="times2${safeName}">10:30 pm (22:30)</label> <br>
                            
                            <input type="radio" id="times3${safeName}" name="dropOff"/>
                            <label for="times3${safeName}">01:00 am (01:00)</label><br>
                       
                            <input type="radio" id="times4${safeName}" name="dropOff"/>
                            <label for="times4${safeName}">Request a later time</label><br>
                        </div>
                         <div id="laterDropOff${safeName}" style="display:none"> 

                            <label>Please suggest a time before 03:00 am here:</label><br>
                            <input type="time"/>
                        </div>
                    </div>
                    
                </div>

                `;

                // Use querySelector, not getElementById, and only after innerHTML is set
                const yesRadio = section.querySelector(`#yesBus${safeName}`);
                const ifYesDiv = section.querySelector(`#ifYesBus${safeName}`);
                const busTimes = section.querySelector(`#timesBus${safeName}`);
                const suggestTime = section.querySelector(`#laterDropOff${safeName}`);
                const times4Radio = section.querySelector(`#times4${safeName}`);

                times4Radio.addEventListener("change", () => {
                    suggestTime.style.display = "block";
                     });

                if (yesRadio && ifYesDiv) {
                    yesRadio.addEventListener("change", function() {
                        ifYesDiv.style.display = "block";
                        busTimes.style.display = "block";
                });
                }
               
                return section;
            }

            // more info button
            const dialog = document.getElementById('drinkInfo');
                const openBtn = document.getElementById('openDialogBtn');
                const closeBtn = document.getElementById('closeDialogBtn');

                openBtn.addEventListener('click', () => {
                dialog.showModal();
                });

                closeBtn.addEventListener('click', () => {
                dialog.close();
                });

                // Optional: Allow closing the dialog by clicking outside of it
                dialog.addEventListener('click', (event) => {
                const rect = dialog.getBoundingClientRect();
                if (
                    event.clientX < rect.left ||
                    event.clientX > rect.right ||
                    event.clientY < rect.top ||
                    event.clientY > rect.bottom
                ) {
                    dialog.close();
                }
                });
            
        </script>

    </body>

</html>