<!DOCTYPE html>
<html lang="en">
    <head>
        <style>
            button {
                
               
                cursor: pointer;
                }

                dialog {
                border: none;
                border-radius: 10px;
                box-shadow: 0 4px 16px rgba(0,0,0,0.25);
                padding: 24px 32px;
                max-width: 600px;
                text-align: left;
                }

                dialog::backdrop {
                background: rgba(0,0,0,0.3);
                }

                .close-btn {
                margin-top: 20px;
                padding: 8px 16px;
                background: #e74c3c;
                color: #fff;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                }

                .close-btn:hover {
                background: #c0392b;
                }
            input[name="radio"][value="no"] { 
            margin-left: 20px; /* Adjust as needed */
            
            }
            .container {
              display: grid;
              grid-template-columns: 250px 300px;
              

            }
            .container > div {
          
              padding: 3px;
              
              text-align: left;
              align-items: left;
            }
        

            .container2 {
              display: grid;
              grid-template-columns: 250px 550px 300px;
              grid-template-rows: 150px;

            }
            .container2 > div {
          
              padding: 2px;
              
              text-align: left;
              align-items: left;
            }

            .container3 {
              display: grid;
              grid-template-columns: 200px 350px 10px 600px;
              

            }
            .container3 > div {
          
              padding: 4px;
              /*border: 1px solid black;*/
              
              text-align: left;
              align-items: left;
            }
            .container4 {
              display: grid;
              grid-template-columns: 500px 300px;
              

            }
            .container4 > div {
          
              padding: 3px;
              
              
              text-align: left;
              align-items: left;
            }

            .smallcontainer {
              display: grid;
              grid-template-columns: 90px 90px 70px 90px 90px 90px;
              

            }
            .smallcontainer div {
          
              padding: 2px;
              
              text-align: left;
              align-items: left;
            }
            .smallcontainer2 {
              display: grid;
              grid-template-columns: 200px 200px 200px;
        
            }
            .smallcontainer2 div {
          
              padding: 2px;
              /*border: 1px solid black;*/
              text-align: left;
              align-items: left;
            }

            .small {
              display: grid;
              grid-template-columns: 30px 150px;
              

            }
            .small div {
          
              padding: 2px;
              
              text-align: left;
              align-items: left;
            }
            input[name="longAns"] {

                width: 300px;
                height: 30px;
                }

            input[name="fname"] {

                width: 190px;
                
                }
           
            </style>
    </head>
    <body>
        <form> 

            <fieldset>
                <legend><h2>Guest Info:</h2></legend>
                <label for="guestNR">How many guests from your group are coming (including children)?</label>
                <input type="number" min=1 max=10 id="guestNR"/>
                <br><br>

                <div id="gInfo" style="display:none">
                    

                </div>

                <br><br>
                <div id="testArray" style="display:none">
                    <input type="button" id="testbtn" value="Click me to see if the GuestInfoStorage array works"/>
                    <input type="button" id="Next2" value="Next"/>  
                </div>

            </fieldset>

            <fieldset id="Menu" style="display:none">
                <legend><h2>Menu</h2></legend>
                <p>The main course will likely be beef. We will update our website with the chosen menu when we know more, but this won't be until 2026. </p>

                <div id="guestMeals">
                </div>
                
                <br><br>
                <div id="testMealArray" style="display:none">
                    <input type="button" id="testMealbtn" value="Click me to see if the MealInfoStorage array works"/>
                    <input type="button" id="Next3" value="Next"/>
                </div>
            </fieldset>

            <fieldset id="Bus" style="display:none">
                <legend><h2>Will any of you be taking the bus? What time?</h2></legend>
                <p>Remember that we will ask that you pay a small sum of money to cover some of the cost of hiring the bus. We will keep this under
                    the price of hiring a taxi, which are notoriously expensive in Norway, though this is always an option. As for payment options, 
                    I'll set that up on the website asap. 

                    Again, we aren't 100% sure about the times for the bus yet, or if we'll hire one for both pick-up and drop-off. It all depends on 
                    the amount of people who want/need to take the bus. All of this info will be posted to the website as soon as we know more.</p>
                
                <div id="BussInf">
                </div>

                <br><br>
                <div id="testBusArray" style="display:none">
                    <input type="button" id="testBusbtn" value="Click me to see if the BusInfoStorage array works"/>
                    <input type="button" id="Next4" value="Next"/>
                </div>

            </fieldset>

            <fieldset id="Drinks" style="display:none">
                <legend><h2>Drink Vouchers</h2></legend>

                <p>Due to limited space and to save time (and because of the alcohol-serving laws in Norway), instead of having a normal bar
                    set-up we have to use drink-vouchers. These will be sold in packs of three on our website, and will be purchaseable using 
                    Vipps (Norway), Paypal and bank transfers. We ask that you buy these in advance, both to save time and so that we get a 
                    good idea of how many vouchers we will need and how many drinks we will need to provide. we will also set things up so that 
                    you can purchase some on-site as a last resort.<b>We will of course cover the welcome-drinks and wine with dinner.</b>
                </p>
                <div class="container4">

                    <div>
                        <b>I will set up the payment options via this website as soon as possible.</b>
                    </div>
                    <div>
                        <button id="openDialogBtn" type="button">More info</button>
                    </div>
                 </div>
                <dialog id="drinkInfo">
                    <h3>Drink menu</h3>
                    <p>
                        We are currently working on a drink menu that we will post to the website at some point. What we do know so far, is that 
                        we want to provide exciting mixed drinks with equally exciting <i>alcohol-free</i> versions! <br> <br>
                        Again, we haven't landed on the exact menu yet, but we know we want to serve pi√±a coladas and margaritas made in a slushie 
                        machine, as well as beer, wine and maybe some home-brewed hard cider and beer too. 
                        <br>
                    </p>
                    <button class="close-btn" id="closeDialogBtn" type="button">Close</button>
                  </dialog>
                  <p></p>
             
                <div id="DrinkNext">
                </div>
                <div id="Next5" style="display:none">
                    <input type="button" id="btn5" value="Next" />
                </div>
                
            </fieldset>

            <fieldset id="End" style="display:none">
                <legend>Any questions?</legend>
               
                <label for="Questions">Please write any questions you have here and we will get back to you as soon as possible!</label><br>
                <input type="text" id="Questions" name="longAns"/>
                <submit></submit>
            </fieldset>
        </form>
        
        <!--What do I have left: 
        1) include +1's in the menu function XXX

        2) make the functions that append the bus and drink input 

        3) make it so that the next buttons can only be interacted with if all previous inputs are filled in. 
        4) connect to a google sheets document-->


        <!-- <script src="building_own_code.js"></script> -->
        <script>
            const guests = document.getElementById("guestNR");
            const testbtn = document.getElementById("testbtn");
            const testArrayDiv = document.getElementById("testArray");

            const testMealbtn = document.getElementById("testMealbtn");
            const testMealArray = document.getElementById("testMealArray");

            const testBusbtn = document.getElementById("testBusbtn");
            const testBusArray = document.getElementById("testBusArray");

             // more info button
            const dialog = document.getElementById('drinkInfo'); // retrieves the drinkInfo element
            const openBtn = document.getElementById('openDialogBtn'); //retrieves the openDialog button
            const closeBtn = document.getElementById('closeDialogBtn'); //retrieves the close Dialog button
            
            let GuestInfoStorage = []; // Empty array to store all of the user answers from the GuestInfo fieldset in
            let MealInfoStorage = [];
            let BusInfoStorage = [];
            let DrinkInfoStorage = [];
            let QuestionInfoStorage = [];

            // Keep backup arrays for restoring
            let oldGuestInfo = [];
            let oldMealInfo = [];
            let oldBusInfo = [];
            let oldDrinkInfo = [];
            let oldQuestion = [];

            let counting = 0; // defines a global counting variable that is redefined when the updateField function is run. Stores this info for the next part of the RSVP.

//Schemas-------------------------------------------------------
            // a schema that defines the rules for the GuestInfoStorage array. Used later for validation checks
            const guestInfoSchema = [
                { field: "GuestName", message: "Please enter the name for Guest {n}" },
                { field: "plus1", message: "Please select if Guest {n} wants a +1" },
                { field: "plusOneName", if: { field: "plus1", value: "yes" }, message: "Please enter the +1 name for Guest {n}" },
                { field: "plusOneRel", if: { field: "plus1", value: "yes" }, message: "Please enter the +1 relationship for Guest {n}" }
            ];
            
            const mealInfoSchema = [
                { field: "menuChoice",  message: "Please select a meal for Guest {n}" },
                { field: "severityChoice", if: { field: "allergenSelected", value: "true" }, message: "Please enter the severity of your allergies" },
            ];  
            
            const busInfoSchema = [
                { field: "hotelName",  if: {field: "busAnswer", value: "Yes"}, message: "Please enter the hotel name for Guest {n}" },
                { field: "busTimes",  if: {field: "busAnswer", value: "Yes"}, message: "Please pick a bus time for Guest {n}" },
                { field: "busTimes", if: { field: "timeSelected", value: "true" }, message: "Please enter a suggested time for Guest {n}" },
            ]; 

// Functions:
//--------------------------------------------------------------

//For the first guest info section --------------------------------------------------------------
            function updateField() {
                document.getElementById("Menu").style.display = "none"; //hides the menu section if it was previously filled out
                document.getElementById("guestMeals").innerHTML= ""; //resets the menu section if it was previously filled out
                document.getElementById("Bus").style.display = "none"; //hides the Bus section if it was previously filled out
                document.getElementById("BussInf").innerHTML= ""; //resets the bus section if it was previously filled out
                document.getElementById("Drinks").style.display = "none"; //hides the drinks section if it was previously filled out
                document.getElementById("DrinkNext").innerHTML = ""; //resets the drinks section if it was previously filled out
                document.getElementById("End").style.display = "none"; //hides the End question section if it was previously filled out


                document.getElementById("gInfo").innerHTML = '<legend><h3>Enter your full names here:</h3></legend><br>'; //deletes the html content of the guestDetailsDiv element.
                GuestInfoStorage = [];
                counting = guests.value; // redefines counting to match the number of guests entered by the user. 
                
                if (counting > 0 && counting < 11){ // Since I want a max of 10 guests, this makes sure that the code only works when the entered number is above 0 but below 11. 
                
                    document.getElementById("gInfo").style.display = "block";
                    testArrayDiv.style.display = "block";

                    for (let i = 0; i<counting; i++){ //runs the following code up to the number specified by user. 
                        let GuestiInfo = {}; // Empty object to store all of the answers in, Guest Name, +1 answer, +1 name, +1 relationship
                
                        // myInp is a new div element of the class container that will be added to gInfo later
                        const myInp = document.createElement("div"); myInp.className="container";

                        // defines the code contained in myInp
                        myInp.innerHTML = `
                        <div>
                        <label>Guest ${i+1} full name: </label>
                        <input type="text" id="GuestID${i+1}" name="fname" required/> <br><br>
                        </div>
                        <div id="yesno+1${i+1}">
                            <legend>Would you like to request a +1?</legend>
                            <input type="radio" id="yes${i+1}" name="+1${i+1}" value="yes"required/>
                            <label for="yes${i+1}">Yes</label>
                            <input type="radio" id="no${i+1}" name="+1${i+1}" value="no" required/>
                            <label for="no${i+1}">No</label><br><br>
                        </div>
                        `;

                        // appends myInp to ginfo in the document.
                        document.getElementById("gInfo").appendChild(myInp);

                        //saves the GuestName in GuestInfo for later
                        const GuestName = document.getElementById(`GuestID${i+1}`);
                        GuestName.addEventListener("change", function(){
                            GuestiInfo.GuestName = this.value;
                        });

                        // Saves the yes and no inputs as constants
                        const plusOneYes = document.getElementById(`yes${i+1}`);
                        const plusOneNo = document.getElementById(`no${i+1}`);

                        // adds an eventlistener to the yes radio button. This eventlistener adds the input fields for plus one. 
                        plusOneYes.addEventListener("click", function() {
                            document.getElementById("Menu").style.display = "none"; //hides the menu section if it was previously filled out
                            document.getElementById("guestMeals").innerHTML= ""; //resets the menu section if it was previously filled out
                            document.getElementById("Bus").style.display = "none"; //hides the Bus section if it was previously filled out
                            document.getElementById("BussInf").innerHTML= ""; //resets the bus section if it was previously filled out
                            document.getElementById("Drinks").style.display = "none"; //hides the drinks section if it was previously filled out
                            document.getElementById("DrinkNext").innerHTML = ""; //resets the drinks section if it was previously filled out
                            document.getElementById("End").style.display = "none"; //hides the End question section if it was previously filled out

                            //creates the div element that contains the plus one input fields and sets the class to container grid for styling 
                            const plusOneInfo = document.createElement("div"); plusOneInfo.className = "container"; plusOneInfo.id = `+1info${i+1}`;

                            // writes the info in the newly created div
                            plusOneInfo.innerHTML = `
                            <div> <label>Name of plus one for Guest ${i+1}: </label> </div>
                            <div> <label>Relationship between plus one and Guest ${i+1}: </label></div>
                            <div><input type="text" id="plusOneName${i+1}" name="fname" /> </div>
                            <div><input type="text" id="plusOneRel${i+1}" name="longAns"/></div> <br><br>`;

                            // appends this plus one info to myInp
                            myInp.appendChild(plusOneInfo);

                            // saves the answer to GuestInfo
                            GuestiInfo.plus1 = "yes";

                            // gets the plus one input answers
                            const plusOneName = document.getElementById(`plusOneName${i+1}`);
                            const plusOneRel = document.getElementById(`plusOneRel${i+1}`);

                            //adds an eventlistener to the plus one name that saves these values to GuestInfo for later
                            plusOneName.addEventListener("change", function(){
                                GuestiInfo.plusOneName = this.value;
                            });

                            //adds an eventlistener to the plus one relationship that saves these values to GuestInfo for later
                            plusOneRel.addEventListener("change", function(){
                                GuestiInfo.plusOneRel = this.value;
                            });
                        })

                        // adds an eventlistener to the no radio button that 1) removes the +1 info input fields if the user clicked yes first and 2) adds this answer to GuestInfo
                        plusOneNo.addEventListener("click", function() {
                            document.getElementById("Menu").style.display = "none"; //hides the menu section if it was previously filled out
                            document.getElementById("guestMeals").innerHTML= ""; //resets the menu section if it was previously filled out
                            document.getElementById("Bus").style.display = "none"; //hides the Bus section if it was previously filled out
                            document.getElementById("BussInf").innerHTML= ""; //resets the bus section if it was previously filled out
                            document.getElementById("Drinks").style.display = "none"; //hides the drinks section if it was previously filled out
                            document.getElementById("DrinkNext").innerHTML = ""; //resets the drinks section if it was previously filled out
                            document.getElementById("End").style.display = "none"; //hides the End question section if it was previously filled out
                            
                            const changedFromYes = document.getElementById(`+1info${i+1}`) // retrieves the +1info from the document
                            if (changedFromYes) changedFromYes.remove(); //if this +1info exists in the document, it is removed
                            GuestiInfo.plus1 = "no"; // stores the new answer in GuestiInfo
                        })

                        
                        // Instead of GuestInfoStorage.push(GuestiInfo);
                        GuestInfoStorage[i] = GuestiInfo; // adds all of the information gathered into the item GuestInfo into a global list by index. This keeps things ordered for later
                    };  
                }
                // If the number of guests entered is not between 1 and 10, this alert will pop up.
                else {
                    window.alert("Please enter a number between 1 and 10");
                }
            }

//For the second, Meal info section --------------------------------------------------------------
        
            // this function updates the meal fields to include all of the guests entered in the first question.
            function updateMeal() {
                document.getElementById("Bus").style.display = "none"; //hides the Bus section if it was previously filled out
                document.getElementById("BussInf").innerHTML= ""; //resets the bus section if it was previously filled out
                document.getElementById("Drinks").style.display = "none"; //hides the drinks section if it was previously filled out
                document.getElementById("DrinkNext").innerHTML = ""; //resets the drinks section if it was previously filled out
                document.getElementById("End").style.display = "none"; //hides the End question section if it was previously filled out
           
                document.getElementById("Menu").style.display = "block"; // makes the div element called Menu visible

                //retrieves the guestMeals div from the Menu div
                const guestMealsDiv = document.getElementById("guestMeals");
                testMealArray.style.display = "block";
               
                // for i in range (0, counting, 1):
                for (let i = 0; i<counting; i++){
                    
                    //retrieves the guest name and plus 1 name if it exists from GuestInfoStorage
                    let guestName = GuestInfoStorage[i].GuestName;
                    let plus1Name = GuestInfoStorage[i].plusOneName || ""; // If undefined, use ""
                   
                  
                    // appends the content created in the createMealSection function for the guest to guestMeals 
                    guestMealsDiv.appendChild(createMealSection(guestName));

                    // if plus1Name (with spaces removed so no error is thrown) isn't empty
                    if (plus1Name.trim() !== "") {
                        // append the plus1Name content created by createMealSection to guestMeals
                        guestMealsDiv.appendChild(createMealSection(plus1Name));
                    }
                    MealInfoStorage[i] = mealInfo
                };
            }
            
             // this function takes a string and replaces white spaces with _
             function makeSafe(str) {
                return str.replace(/\W/g, '_');
            }

// Helper function for updateMeal that creates the content for each guest and/or plus one entered in the first question
            function createMealSection(personName) {
                let mealInfo = {};
                mealInfo.GuestName = personName
                //replaces whitespaces from the person name with _ for element ids
                const safeName = makeSafe(personName);

                //creates a new div element classed as container2 for styling
                let section = document.createElement("div");section.className = "container2";
                section.innerHTML = `
                <div>
                    <legend><b>Enter your meal preferences here:</b></legend><br>
                    <label>${personName}: </label>
                    <select id="menu${safeName}" class="menuItem${safeName}"> 
                        <option value="">--Please choose an option--</option>
                        <option value="Standard meal">Standard meal</option>
                        <option value="Vegan">Vegan</option>
                        <option value="Vegetarian">Vegetarian</option>
                        </select>
                </div>
                <div>
                    <legend><b>Do you have any of the following allergies/intolerances?</b></legend>
                    <div class="smallcontainer">
                        <div>
                            <input type="checkbox" id="Gluten${safeName}" name="allergen${safeName}" value="Gluten" class="menuItem${safeName}"/>
                            <label for="Gluten${safeName}">Gluten</label>
                        </div>
                        <div>
                            <select id="Gsev${safeName}" name="severity${safeName}" class="menuItem${safeName}">
                                <option>--severity--</option>
                                <option>Mild</option>
                                <option>Moderate</option>
                                <option>Severe</option>
                            </select>
                        </div>  
                        <div>
                            <input type="checkbox" id="Dairy${safeName}" name="allergen${safeName}" value="Dairy" class="menuItem${safeName}"/>
                            <label for="Dairy${safeName}">Dairy</label>
                        </div>
                        <div>
                            <select id="Dsev${safeName}" name="severity${safeName}" class="menuItem${safeName}">
                                <option>--severity--</option>
                                <option>Mild</option>
                                <option>Moderate</option>
                                <option>Severe</option>
                            </select>
                        </div> 
                        <div>
                        <input type="checkbox" id="Peanuts${safeName}" name="allergen${safeName}" value="Peanuts" class="menuItem${safeName}"/>
                            <label for="Peanuts${safeName}">Peanuts</label>
                        </div>
                        <div>
                            <select id="Psev${safeName}" name="severity${safeName}" class="menuItem${safeName}">
                                <option>--severity--</option>
                                <option>Mild</option>
                                <option>Moderate</option>
                                <option>Severe</option>
                            </select>
                        </div> 
                        <div>
                            <input type="checkbox" id="treeNuts${safeName}" name="allergen${safeName}" value="treeNuts" class="menuItem${safeName}"/>
                            <label for="treeNuts${safeName}">Tree nuts</label>
                        </div>
                        <div>
                            <select id="TNsev${safeName}" name="severity${safeName}" class="menuItem${safeName}">
                                <option>--severity--</option>
                                <option>Mild</option>
                                <option>Moderate</option>
                                <option>Severe</option>
                            </select>
                        </div>

                        <div>
                            <input type="checkbox" id="Egg${safeName}" name="allergen${safeName}" value="Egg" class="menuItem${safeName}"/>
                            <label for="Egg${safeName}">Egg</label>
                        </div>
                        <div>
                            <select id="Esev${safeName}" name="severity${safeName}" class="menuItem${safeName}">
                                <option>--severity--</option>
                                <option>Mild</option>
                                <option>Moderate</option>
                                <option>Severe</option>
                            </select>
                        </div>

                        <div>
                            <input type="checkbox" id="Soy${safeName}" name="allergen${safeName}" value="Soy" class="menuItem${safeName}"/>
                            <label for="Soy${safeName}">Soy</label>
                        </div>
                        <div>
                            <select id="Ssev${safeName}" name="severity${safeName}" class="menuItem${safeName}">
                                <option>--severity--</option>
                                <option>Mild</option>
                                <option>Moderate</option>
                                <option>Severe</option>
                            </select>
                        </div>

                        <div>
                            <input type="checkbox" id="Wheat${safeName}" name="allergen${safeName}" value="Wheat" class="menuItem${safeName}"/>
                            <label for="Wheat${safeName}">Wheat</label>
                        </div>
                        <div>
                            <select id="Wsev${safeName}" name="severity${safeName}" class="menuItem${safeName}">
                                <option>--severity--</option>
                                <option>Mild</option>
                                <option>Moderate</option>
                                <option>Severe</option>
                            </select>
                        </div>

                        <div>
                            <input type="checkbox" id="Fish${safeName}" name="allergen${safeName}" value="Fish" class="menuItem${safeName}"/>
                            <label for="Fish${safeName}">Fish</label>
                        </div> 
                        <div>
                            <select id="Fsev${safeName}" name="severity${safeName}" class="menuItem${safeName}">
                                <option>--severity--</option>
                                <option>Mild</option>
                                <option>Moderate</option>
                                <option>Severe</option>
                            </select>
                        </div>
                        
                        <div>
                            <input type="checkbox" id="Shellfish${safeName}" name="allergen${safeName}" value="Shellfish" class="menuItem${safeName}"/>
                            <label for="Shellfish${safeName}">Shellfish</label>
                        </div>
                        <div>
                            <select id="SFsev${safeName}" name="severity${safeName}" class="menuItem${safeName}">
                                <option>--severity--</option>
                                <option>Mild</option>
                                <option>Moderate</option>
                                <option>Severe</option>
                            </select>
                        </div>
                     </div>
                </div>
                <div>
                    <legend><b>Any other intolerances/allergies we should know about?:</b></legend><br>
                    <input type="text" id="allergies${safeName}" name="longAns" class="menuItem${safeName}"/>
                </div>
                `;
                // if the no radio button is selected, the hotel name input and the bus times input are made invisible again if they were already visible
                
                const menuChoice = section.querySelector(`#menu${safeName}`);
                const allergenChoice = section.querySelectorAll(`[name="allergen${safeName}"]`);
                const severityChoice = section.querySelectorAll(`[name="severity${safeName}"]`);
                const otherAllergensChoice = section.querySelector(`#allergies${safeName}`);

                 // When creating/selecting the menu dropdown
                 menuChoice.addEventListener("change", function() {
                    if (this.value === "--Please choose an option--") {
                        mealInfo.menuChoice = "";
                    } else {
                        mealInfo.menuChoice = this.value;
                    }
                });
                
                // scans the answers to see if an allergy has been checked off, and appends this as well as any selected variable to mealInfo
                function updateAllergenChoice() {
                    let checkedAllergens = Array.from(allergenChoice)
                        .filter(cb => cb.checked)
                        .map(cb => cb.value);

                    // For the schema to work, we need to check that checkedAllergens is true. if it is and the severity hasn't been filled, an alert will pop up.
                    mealInfo.allergenSelected = checkedAllergens ? "true" : ""; 
                    mealInfo.allergenChoice = checkedAllergens;
                    
                    // Checks that the severity has been selected when the allergy check box next to it is selected.
                    let checkedSeverities = Array.from(severityChoice)
                        .filter(sel => sel.value === "--severity--" ? "" : this.value)
                        .map(sel => sel.value);
                    mealInfo.severityChoice = checkedSeverities;
                };

                allergenChoice.forEach(function(cb) {
                    cb.addEventListener("change", updateAllergenChoice);
                });
                severityChoice.forEach(function(sel) {
                    sel.addEventListener("change", updateAllergenChoice);
                });


                otherAllergensChoice.addEventListener("change", function(){
                        mealInfo.otherAllergens = this.value;
                
                });

                const menuChange = section.querySelectorAll(`.menuItem${safeName}`); // retrieves all other drop-off radio buttons by the class attribute (indicated with a . instead of #)
                 // adds eventlistener to the other bus-times radio buttons, which hides the time-suggestion field when selected
                if (menuChange){ // if (times) check is a safety net to make sure times exists before trying to use it.
                    //forEach loops through each element/item in the times object
                    menuChange.forEach(function(element) {
                        element.addEventListener("change", function() {
                            document.getElementById("Bus").style.display = "none"; //hides the Bus section if it was previously filled out
                            document.getElementById("Drinks").style.display = "none"; //hides the drinks section if it was previously filled out
                            document.getElementById("End").style.display = "none"; //hides the End question section if it was previously filled out
                        });
                    });
                }
                MealInfoStorage.push(mealInfo);
            //returns the new div element section 
            return section;
            }


// creates the bus input fields for each guest based on the first question
            function updateBus (){
                document.getElementById("Drinks").style.display = "none"; //hides the drinks section if it was previously filled out
                document.getElementById("DrinkNext").innerHTML = ""; //resets the drinks section if it was previously filled out
                document.getElementById("End").style.display = "none"; //hides the End question section if it was previously filled out
                
                document.getElementById("Bus").style.display = "block"; // unhides the Bus div element
                testBusArray.style.display = "block";

                // retrieves the BussInf element which the new inputs will be added to:
                const guestBusDiv = document.getElementById("BussInf");
                
                // for i in range(0, counting, 1):
                for (let i = 0; i<counting; i++){
                    //retrives the namees of the guest an +1 if it exists
                    let guestName = GuestInfoStorage[i].GuestName;
                    let plus1Name = GuestInfoStorage[i].plusOneName || ""; // If undefined, use ""

                    //appends the input fields for the guest created by the createBusSection function
                    guestBusDiv.appendChild(createBusSection(guestName));

                    //if there is a plus one name (with spaces removed by trim()) that isn't empty, append the input fields for them created by createBusSection function
                    if (plus1Name.trim() !== "") {
                        guestBusDiv.appendChild(createBusSection(plus1Name));
                    }
                    BusInfoStorage[i] = busInfo;
                };
        
            }

// Helper function for updatebus
            function createBusSection(personName) {
                let busInfo = {};

                busInfo.GuestName = personName

                const safeName = makeSafe(personName); // removes whitespaces from the name, replacing them with _

                //creates a new div element called section, making it class=container3 for styling
                let section = document.createElement("div");section.className = "container3";
                section.innerHTML = `
                 <div>
                    <label>${personName}: </label><br>
                    <input type="radio" id="yesBus${safeName}" name="Bus${safeName}" value="yes"/>
                    <label for="yesBus${safeName}">Yes</label>

                    <input type="radio" id="noBus${safeName}" name="Bus${safeName}" value="no"/>
                    <label for="noBus${safeName}">No</label>
                 </div>

                 <div id="ifYesBus${safeName}" style="display:none">
                    <legend><b>Which hotel will you be staying at?</b></legend><br>
                    <label>(Where should the bus pick you up/ drop you off?)</label>
                    <input type="text" id="hName${safeName}" name="longAns"/>
                 </div>
                 <div>
                    </div>

                 <div id="timesBus${safeName}" style="display:none">
                    <legend><b>What times would you want to take the bus?</b></legend>
                    <p>Info: we are early-birds, but if enough people would like to stay later than 01:00 am, we will consider pushing 
                        the second drop-off time back</p>

                    <div class="smallcontainer2"> 
                        <div class="small">
                            <div>
                            <input type="checkbox" id="times1${safeName}"/>
                            </div>
                            <div>
                            <label for="times1${safeName}">Pick-up at 01:30 pm (13:30)</label>
                            </div>
                        </div>
                        <div>
                            <legend>Drop-off times</legend>
                            <input type="radio" id="times2${safeName}" value="10:30 pm" name="dropOff${safeName}" class="noSuggest${safeName}"/>
                            <label for="times2${safeName}">10:30 pm (22:30)</label> <br>
                            
                            <input type="radio" id="times3${safeName}" value="01:00 am" name="dropOff${safeName}" class="noSuggest${safeName}"/>
                            <label for="times3${safeName}">01:00 am (01:00)</label><br>
                       
                            <input type="radio" id="times4${safeName}" name="dropOff${safeName}"/>
                            <label for="times4${safeName}">Request a later time</label><br>
                        </div>
                         <div id="laterDropOff${safeName}" style="display:none"> 

                            <label>Please suggest a time before 03:00 am here:</label><br>
                            <input type="time" id="Suggested${safeName}"/>
                        </div>
                    </div>
                    
                </div>`;

                // querySelector, not getElementById, is used because of the way the code was before (unsanitized by safeName). can only be after innerHTML is set
                const yesRadio = section.querySelector(`#yesBus${safeName}`); // retrieves the yes radio button
                const noRadio = section.querySelector(`#noBus${safeName}`); // retrieves the no radio button
                const ifYesDiv = section.querySelector(`#ifYesBus${safeName}`); // retrieves the hotel name input 
                const hotelInp = section.querySelector(`#hName${safeName}`);
                const busTimes = section.querySelector(`#timesBus${safeName}`); // retrieves the bus times div element
                const suggestTime = section.querySelector(`#Suggested${safeName}`); // retrieves the later drop-off radio button
                const times = section.querySelectorAll(`.noSuggest${safeName}`); // retrieves all other drop-off radio buttons by the class attribute (indicated with a . instead of #)
                const times4Radio = section.querySelector(`#times4${safeName}`); // retrieves the later drop-off time suggestion 
                const pickUp = section.querySelector(`#times1${safeName}`);

                //if the yes radio button is selected, the hotel name input and the bus times input are made visible
                if (yesRadio) {
                    yesRadio.addEventListener("change", function() {
                        document.getElementById("Drinks").style.display = "none"; //hides the drinks section if it was previously filled out
                        document.getElementById("End").style.display = "none"; //hides the End question section if it was previously filled out
                        busInfo.busAnswer = "Yes";
                        ifYesDiv.style.display = "block";
                        busTimes.style.display = "block";
                    
                     });

                     hotelInp.addEventListener("change", function(){
                        busInfo.hotelName = this.value
                    });
                };

               

                // if the no radio button is selected, the hotel name input and the bus times input are made invisible again if they were already visible
                if (noRadio){
                    noRadio.addEventListener("change", function(){
                        document.getElementById("Drinks").style.display = "none"; //hides the drinks section if it was previously filled out
                        document.getElementById("End").style.display = "none"; //hides the End question section if it was previously filled out
                        busInfo.busTimes.remove();
                        busInfo.suggestedTime.remove();

                        ifYesDiv.style.display = "none";
                        busTimes.style.display = "none";
                    });
                };
           
                if (pickUp){
                    pickUp.addEventListener("change", function(){
                        document.getElementById("DrinkNext").innerHTML = ""; //resets the drinks section if it was previously filled out
                        document.getElementById("End").style.display = "none"; //hides the End question section if it was previously filled out
                        if (this.checked){
                            busInfo.pickUpYes = "Yes"
                        }else{delete busInfo.pickUpYes};
                        
                    });
                };

                // adds eventlistener to the times4 radio button, which makes the time-suggestion field visible
                if (times4Radio){
                    times4Radio.addEventListener("change", function () {
                        document.getElementById("DrinkNext").innerHTML = ""; //resets the drinks section if it was previously filled out
                        document.getElementById("End").style.display = "none"; //hides the End question section if it was previously filled out
                        //busInfo.suggestedTime.remove
                        busInfo.timeSelected = "true"
                        document.getElementById(`laterDropOff${safeName}`).style.display = "block";
                        });
                        suggestTime.addEventListener("change", function(){
                            busInfo.busTimes = this.value
                        });
                }
                 // adds eventlistener to the other bus-times radio buttons, which hides the time-suggestion field when selected
                if (times){ // if (times) check is a safety net to make sure times exists before trying to use it.
                    //forEach loops through each element/item in the times object
                    times.forEach(function(element) {
                        document.getElementById("DrinkNext").innerHTML = ""; //resets the drinks section if it was previously filled out
                        document.getElementById("End").style.display = "none"; //hides the End question section if it was previously filled out

                        element.addEventListener("change", function() {
                            busInfo.timeSelected = "true"
                            document.getElementById(`laterDropOff${safeName}`).style.display = "none";
                            busInfo.busTimes = this.value
                        });
                    });
                    BusInfoStorage.push(busInfo)
                }
                return section;
            }

  
            //drinks function
            function updateDrinks (){
                document.getElementById("DrinkNext").innerHTML = ''; //deletes the html content of the DrinkNext element.
                document.getElementById("End").style.display = "none"; //hides the End question section if it was previously filled out
                document.getElementById("Drinks").style.display = "block"; // makes the Drinks element visible
               
                const guestDrink = document.getElementById("DrinkNext"); //retrieves the DrinkNext element from the document
               
                for (let i = 0; i<counting; i++){

                    let guestName = GuestInfoStorage[i].GuestName; // retrieves the guest name from GuestInfoStorage

                    // retrieves the +1 name from GuestInfoStorage if it exists, and sets plus1Name to "" if it doesnt exits (is undefined)
                    let plus1Name = GuestInfoStorage[i].plusOneName || ""; 

                    // appends the drink inputs for each guest to the DrinkNext element in the document using the createDrinkSection function
                    guestDrink.appendChild(createDrinksSection(guestName)); 

                    if (plus1Name.trim() !== "") { // if the plus 1 name exists and isn't just "" when all the whitespace is removed, the following happens: 
                        guestDrink.appendChild(createDrinksSection(plus1Name)); // the +1 name is appended to the DrinkNext element in the document
                    }
                };
            }

// Helper function for updateDrinks
            function createDrinksSection(personName) {
                const safeName = makeSafe(personName) // replaces all whitespaces in the name with _

                // creates a new div element using class="container3" for styling
                let section = document.createElement("div");section.className = "container3";
                section.innerHTML = `
                 <div>
                    <legend>Are you interested in getting some vouchers?</legend>

                    <label>${personName}: </label><br>
                    <input type="radio" id="yesDrinks${safeName}" name="drinkName${safeName}" value="yes"/>
                    <label for="yesBus${safeName}">Yes</label>

                    <input type="radio" id="noDrinks${safeName}" name="drinkName${safeName}" value="no"/>
                    <label for="noBus${safeName}">No</label>
                 </div>`;

                const yesDrinks = section.querySelector(`#yesDrinks${safeName}`); //retrieves the yes radio button
                const noDrinks = section.querySelector(`#noDrinks${safeName}`); //retrieves the no radio button

                // adds eventlistener to the yes and no radio buttons, which displays the next button when selected
                if (yesDrinks) { // if (yesDrinks) check is a safety net to make sure times exists before trying to use it.
                        yesDrinks.addEventListener("change", function() {
                            document.getElementById("Next5").style.display = "block";
                        });
                    };
                     // adds eventlistener to the no radio button, which displays the next button when selected
                    if (noDrinks) {
                        noDrinks.addEventListener("change", function() {
                            document.getElementById("Next5").style.display = "block";
                        });
                    };
                return section;
            }

           
 
            //universal validation function
            function validateInfo(infoList, schema) {
                // for i in range(0, len(infoList), 1):
                for (let i = 0; i < infoList.length; i++) {
                    // answer = all answers from guest i
                    const answer = infoList[i];
                    // for rule in schema
                    for (const rule of schema) {

                        // If there's an if condition (like if yes is selected), check it
                        if (rule.if) {
                            // if the answer's if condition entered by the user is the same as the value in the schema, then add the next if check
                            if (answer[rule.if.field] === rule.if.value) {
                                // if the user's input is unanswered or just whitespace send an alert, and stop the event (by returning false) that is being validated 
                                if (!answer[rule.field] || answer[rule.field].toString().trim() === "") {
                                    alert(rule.message ? rule.message.replace('{n}', i+1) : `Please fill in ${rule.field} for item ${i+1}`);
                                    return false;
                                }
                            }
                        // if there isn't an if condition tied to another input field, run this code instead:
                        } else {
                            // if the answer field is empty, return an alert and stop the associated even from firing using return false
                            if (!answer[rule.field] || answer[rule.field].toString().trim() === "") {
                                alert(rule.message ? rule.message.replace('{n}', i+1) : `Please fill in ${rule.field} for item ${i+1}`);
                                return false;
                            }
                        }
                    }
                }
                // if all the above checks aren't true, then allow the connected event to fire by returning true
                return true;
            }

// Event listeners
//--------------------------------------------------
            guests.addEventListener("change", updateField);

            testbtn.addEventListener("click", function() {
                console.log(GuestInfoStorage);
                alert(JSON.stringify(GuestInfoStorage, null, 2));
             });

             testMealbtn.addEventListener("click", function() {
                console.log(MealInfoStorage);
                alert(JSON.stringify(MealInfoStorage, null, 2));
             });

             testBusbtn.addEventListener("click", function() {
                console.log(BusInfoStorage);
                alert(JSON.stringify(BusInfoStorage, null, 2));
             });

            document.getElementById("Next2").addEventListener("click", function() {
                if (validateInfo(GuestInfoStorage, guestInfoSchema)) {
                    updateMeal();
                }
            });


            document.getElementById("Next3").addEventListener("click", function() {
                if (validateInfo(MealInfoStorage, mealInfoSchema)) {
                    updateBus();
                }
            })

            document.getElementById("Next4").addEventListener("click", function() {
                if (validateInfo(BusInfoStorage, busInfoSchema)) {
                    updateDrinks();
                }
            })
            
            //Next4.addEventListener("click", updateDrinks);

            // adds an eventlistener to the open dialog button that shows the drinkInfo element usig showModal
            openBtn.addEventListener('click', function() {
                dialog.showModal(); // showModal shows a text box that overlays the rest of the webpage, making that webpage inactive until the modal is closed again.
            });

            // adds an eventlistener to the close dialog button that shows the drinkInfo element usig showModal
            closeBtn.addEventListener('click', function() {
                dialog.close(); // .close closes a modal (text box that overlays the rest of the webpage, making that webpage inactive) 
            });

            // Optional: Allow closing the dialog by clicking outside of it via an event listener
            dialog.addEventListener('click', function(event) {
                const rect = dialog.getBoundingClientRect();
                if (
                    event.clientX < rect.left ||
                    event.clientX > rect.right ||
                    event.clientY < rect.top ||
                    event.clientY > rect.bottom
                ) {
                    dialog.close();
                }
            });

            //adds an eventlistener to the last next button
            Next5.addEventListener("click", function(){
                document.getElementById("End").style.display = "block"
            });

            
            //Next2.addEventListener("click", updateMeal);

            //Next3.addEventListener("click", updateBus);
            
        </script>

    </body>

</html>